!function(t,i){"use strict";var s=t(i),e=(t(document),i.Modernizr);t.StackSlider=function(i,s){this.$stack=t(s).hide(),this._init(i),this.$maxPileHeight=0},t.StackSlider.defaults={group:"stackgallery",lightbox:!0,speed:600,easing:"ease-in-out",piles:!0,autoheight:!0},t.StackSlider.prototype={_init:function(i){this.options=t.extend(!0,{},t.StackSlider.defaults,i),this.support=e.csstransitions&&e.csstransforms3d;var s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},n={WebkitTransform:"-webkit-transform",MozTransform:"-moz-transform",OTransform:"-o-transform",msTransform:"-ms-transform",transform:"transform"};this.support&&(this.transEndEventName=s[e.prefixed("transition")]+".stackslider",this.transformName=n[e.prefixed("transform")]),this.current=0;var r=this;return r._layout(),0===r.itemsCount?!1:(r._initEvents(),void(this.options.lightbox&&jQuery("."+this.options.group).nchlightbox()))},_layout:function(){var i=this.$stack.children("li");this.itemsCount=i.length,this.$wrapper=t('<div class="st-wrapper"></div>'),this.options.piles&&(this.$lPile=t('<div class="st-stack st-stack-left"></div>'),this.$rPile=t('<div class="st-stack st-stack-right"></div>'),this.$wrapper.append(this.$lPile,this.$rPile)),this.$title=t('<div class="st-title"></div>').appendTo(this.$wrapper),this.itemsCount>1&&(this.$navigation=t('<div class="nav"><span class="st-first">First</span><span class="st-prev">Previous</span><span class="st-next">Next</span><span class="st-last">Last</span></div>'),this.$wrapper.append(this.$navigation));var s="";i.each(function(){var i=t(this);s+='<div class="st-item" data-title="'+i.children("div.st-title").html()+'">'+i.children("div.st-item").html()+"</div>"}),this.$listitems=t('<div class="st-item-list"></div>').html(s),this.$items=this.$listitems.children("div").hide(),this.$wrapper.insertAfter(this.$stack).prepend(this.$listitems),this.$stack.remove(),this.options.piles&&this.$rPile.css("height","+="+5*(this.itemsCount-1)),this._setSize(),this._initItems()},_setSize:function(){var t=this.$items.height(),i=1.25*t;this.radius=this.$wrapper.width()/2-i/2,this.options.piles&&(this.$lPile.css("width","25%"),this.$rPile.css("width","25%"))},_initEvents:function(){var t=this;this.$navigation.children("span.st-next").on({"mousedown.stackslider":function(){t._navigate("next"),t.startflowtimeout=setTimeout(function(){t.flow=!0,t._flow("next")},600)},"mouseup.stackslider mouseleave.stackslider":function(){t._mouseup("next")}}).end().children("span.st-prev").on({"mousedown.stackslider":function(){t._navigate("prev"),t.startflowtimeout=setTimeout(function(){t.flow=!0,t._flow("prev")},600)},"mouseup.stackslider mouseleave.stackslider":function(){t._mouseup("prev")}}).end().children("span.st-first").on({"mousedown.stackslider":function(){t._navigate("first"),t.startflowtimeout=setTimeout(function(){t.flow=!0,t._flow("first")},600),t._mouseup("first")}}).end().children("span.st-last").on({"mousedown.stackslider":function(){t._navigate("last"),t.startflowtimeout=setTimeout(function(){t.flow=!0,t._flow("last")},600),t._mouseup("last")}}),s.on("debouncedresize.stackslider",function(){t._setSize(),t._initItems()})},_mouseup:function(t){var i=this;clearTimeout(this.startflowtimeout),clearTimeout(this.flowtimeout),this.flow&&(setTimeout(function(){0!==i.current&&i.current!==i.itemsCount-1&&i._navigate(t)},100),this.flow=!1)},_flow:function(t){var i=this;this._navigate(t,!0),this.flowtimeout=setTimeout(function(){i._flow(t)},150)},_navigate:function(i,s){var e,n,r,o,a,h=this,l="st-left st-center st-right st-leftflow st-rightflow",c=this.$items.eq(this.current),u=this.$wrapper,d=this.$lPile,f=this.$rPile,p=this.options.piles?d.height()+f.height():80,m=this.options.autoheight,v=this.itemsCount;if("next"===i&&this.current<this.itemsCount-1)++this.current,n="st-left",e=s?"st-leftflow":n,r="right",o="left",a="normal";else if("prev"===i&&this.current>0)--this.current,n="st-right",e=s?"st-rightflow":n,r="left",o="right",a="normal";else if("first"===i&&this.current>0)this.current=0,n="st-right",e=s?"st-rightflow":n,r="left",o="right",a="circle";else{if(!("last"===i&&this.current<this.itemsCount-1))return!1;this.current=this.itemsCount-1,n="st-left",e=s?"st-leftflow":n,r="right",o="left",a="circle"}this._updatePile(r,"out",a,v);var g=this.$items.eq(this.current);c.removeClass(l).addClass(e),this.support?c.on(this.transEndEventName,function(){t(this).removeClass(l).addClass(n).off(h.transEndEventName),h._updatePile(o,"in",a,v)}):(c.removeClass(l).addClass(n),this._updatePile(o,"in",a,v)),g.show(),setTimeout(function(){(s&&(0===h.current||h.current===h.itemsCount-1)||!s)&&(g.removeClass(l).addClass("st-center"),m&&u.height(g.find("img").height()+p+25))},25),clearTimeout(this.titletimeout);var w=this.support?this.options.speed:0;this.titletimeout=setTimeout(function(){h.$title.html(g.data("title"))},w)},_updatePile:function(t,i,s,e){return this.options.piles?void("right"===t&&"normal"===s?this.$rPile.css("height","in"===i?"+=5":"-=5"):"left"===t&&"normal"===s?this.$lPile.css("height","in"===i?"+=5":"-=5"):"left"===t&&"circle"===s?this.$lPile.css("height","in"===i?5*e-5:"5"):"right"===t&&"circle"===s&&this.$rPile.css("height","in"===i?5*e-5:"5")):!1},_initItems:function(){var i=this,s=this.$wrapper.width(),e=this.$wrapper.height(),n=this.$items.eq(this.current).addClass("st-center").show(),r=this.options.piles?Math.max(this.$lPile.height(),this.$rPile.height())/2:40,o=this.options.piles?this.$lPile.height()+this.$rPile.height():80,a=0;this.$title.html(n.data("title")),this.$items.each(function(){{var n=t(this),o=n.find("img").height(),h=n.width();e-i.radius-o/2}n.index()!==i.current&&n.addClass("st-right"),n.find("img").attr("data-stack",s/n.find("img").attr("data-ratio")),s/n.find("img").attr("data-ratio")>a&&(a=s/n.find("img").attr("data-ratio")),i.support&&n.css({transition:i.transformName+" "+i.options.speed+"ms "+i.options.easing+", opacity "+i.options.speed+"ms "+i.options.easing,transformOrigin:"50% "+(i.radius+o/2-r)+"px"}),n.css({left:s/2-h/2,top:0})}),this.$wrapper.height(this.options.autoheight?n.find("img").height()+o+25:a+o+25)}};var n=function(t){i.console&&i.console.error(t)};t.fn.stackslider=function(i){var s=t.data(this,"stackslider");if("string"==typeof i){var e=Array.prototype.slice.call(arguments,1);this.each(function(){return s?t.isFunction(s[i])&&"_"!==i.charAt(0)?void s[i].apply(s,e):void n("no such method '"+i+"' for stackslider instance"):void n("cannot call methods on stackslider prior to initialization; attempted to call method '"+i+"'")})}else this.each(function(){s?s._init():s=t.data(this,"stackslider",new t.StackSlider(i,this))});return s}}(jQuery,window);