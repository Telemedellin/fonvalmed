!function(e){var t={init:function(t){var n=this,o=e.extend(!0,{},e.fn.badonkatrunc.defaultOptions,t);return"horizontal"!=o.fitDirection&&"vertical"!=o.fitDirection?(e.error("'"+o.fitDirection+"' is not a valid fit direction. Use 'horizontal' or 'vertical.'"),this):"start"!=o.truncateLocation&&"middle"!=o.truncateLocation&&"end"!=o.truncateLocation?(e.error("'"+o.truncateLocation+"' is not a valid truncation location. Use 'start,' 'middle' or 'end.'"),this):o.minimumFontSize>o.maximumFontSize?(e.error("Minimum font size can not exceed the maximum font size."),this):o.minimumLetterSpacing>o.maximumLetterSpacing?(e.error("Minimum letter spacing can not exceed the maximum letter spacing."),this):this.each(function(){var t=e(this),s=e(this).data("badonkatrunc");s&&t.badonkatrunc("destroy");var a=i(t,o,n);e(this).data("badonkatrunc",a),a.init(),a.options.automaticSizeTracking&&r.add(a)})},destroy:function(){return this.each(function(){var t=e(this),i=t.data("badonkatrunc");i.destroy(),r.remove(i),o.remove(i),e(window).unbind(".badonkatrunc"),t.removeData("badonkatrunc")})},refresh:function(){return this.each(function(){var t=e(this),i=t.data("badonkatrunc");o.remove(i),i.refresh()})},changeContents:function(t){return this.each(function(){var i=e(this),n=i.data("badonkatrunc");n.contentHtml="string"==typeof t?e("<div></div>").text(t).html():e(t).html(),o.add(n)})}};e.fn.badonkatrunc=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(e.error("Method "+i+" does not exist on jQuery.badonkatrunc"),void 0):t.init.apply(this,arguments)},e.fn.badonkatrunc.settings={sizeTrackingTimeout:1e3/60},e.fn.badonkatrunc.defaultOptions={automaticSizeTracking:!1,fitDirection:"horizontal",minimumFontSize:1,maximumFontSize:1,fontSizeSynced:!1,minimumLetterSpacing:0,maximumLetterSpacing:0,letterSpacingSynced:!1,truncate:!0,truncateString:"&hellip;",truncateLocation:"end",truncateOnlyWholeWords:!1,extraOptimizeLimit:8},e.fn.btrunc=e.fn.badonkatrunc;var i=function(t,i,n){var r=function(e,t,i){return{content:e,fontSize:t,letterSpacing:i}},o={target:t,options:i,refresh:function(){var e=this,t=a(this.contentHtml),i=this.contentHtml,n=this.options.maximumFontSize,o=this.options.maximumLetterSpacing,c=function(){var t=r(i,n,o);e.renderState(t)},h=function(){return e.getCurrentOverflow()};if(this.options.maximumFontSize-this.options.minimumFontSize>0&&l(e.options.minimumFontSize,e.options.maximumFontSize,function(e){n=e,c()},h),this.options.maximumLetterSpacing-this.options.minimumLetterSpacing>0){var u=1;this.options.truncate&&l(0,1,function(n){u=n,i=s(t,e.options.truncateString,e.options.truncateLocation,n,!0),l(e.options.minimumLetterSpacing,0,function(e){o=e,c()},h),c()},h),1==u&&l(e.options.minimumLetterSpacing,e.options.maximumLetterSpacing,function(e){o=e,c()},h)}this.options.truncate&&l(0,1,function(n){i=s(t,e.options.truncateString,e.options.truncateLocation,n,e.options.truncateOnlyWholeWords),c()},h,this.options.extraOptimizeLimit),this.renderState(r(i,n,o),!this.options.truncate),this.currentOptimalState=this.currentRenderedState,this.syncFonts()},syncFonts:function(){if(n.length>1&&(this.options.fontSizeSynced||this.options.letterSpacingSynced)){for(var t=this.currentOptimalState.fontSize,i=this.currentOptimalState.letterSpacing,r=0;r<n.length;r++){var o=e(n[r]).data("badonkatrunc");null!=o&&null!=o.currentOptimalState&&(o.currentOptimalState.fontSize<t&&(t=o.currentOptimalState.fontSize),o.currentOptimalState.letterSpacing<i&&(i=o.currentOptimalState.letterSpacing))}for(var r=0;r<n.length;r++){var o=e(n[r]).data("badonkatrunc");null!=o&&o.acceptFontSync(t,i)}}},acceptFontSync:function(e,t){var i=this,n=a(this.contentHtml),o=this.contentHtml;null!=this.currentOptimalState&&(this.options.fontSizeSynced||(e=this.currentOptimalState.fontSize),this.options.letterSpacingSynced||(t=this.currentOptimalState.letterSpacing));var c=function(){i.renderState(r(o,e,t))},h=function(){return i.getCurrentOverflow()};this.options.truncate&&l(0,1,function(e){o=s(n,i.options.truncateString,i.options.truncateLocation,e,i.options.truncateOnlyWholeWords),c()},h),this.renderState(r(o,e,t),!this.options.truncate)},init:function(){this.contentHtml=this.target.html(),this.settingsWrapper=e('<div style="margin: 0px; padding: 0px; border: 0px;"></div>'),this.settingsWrapper.addClass("badonkatrunc-wrapper"),e.browser.mozilla||e.browser.opera||e.browser.msie&&"7.0"==e.browser.version||this.settingsWrapper.css("display","block"),this.target.empty(),this.target.append(this.settingsWrapper),this.refresh()},destroy:function(){this.target.empty(),this.target.append(this.contentHtml)},renderState:function(e,t){this.settingsWrapper.css("font-size",e.fontSize+"em"),this.settingsWrapper.css("letter-spacing",e.letterSpacing+"em");var i=t||"horizontal"!=this.options.fitDirection?"normal":"nowrap";this.settingsWrapper.css("white-space",i),this.settingsWrapper.empty(),this.settingsWrapper.append(e.content),this.currentRenderedState=e},getCurrentOverflow:function(){var e=this.settingsWrapper[0],i="horizontal"==this.options.fitDirection?e.scrollWidth-t.width():e.offsetHeight-t.height();return i}};return o},n=function(t,i,n,r){var o={_instances:[],_updateLoop:function(){if(e.isFunction(t))for(var i=0;i<o._instances.length;i++)t(o._instances[i]);null!=r?o._instances.length>0&&setTimeout(o._updateLoop,r):o._instances=[]},add:function(t){-1==e.inArray(t,this._instances)&&(e.isFunction(i)&&i(t),this._instances.push(t),1==this._instances.length&&(null==r?setTimeout(this._updateLoop):this._updateLoop()))},remove:function(t){var i=e.inArray(t,this._instances);-1!=i&&(this._instances.splice(i,1),e.isFunction(n)&&n(t))}};return o},r=n(function(e){e.elementSizeCache.update()},function(e){e.elementSizeCache={width:null,height:null,update:function(){var t=e.target.width(),i=e.target.height(),n=null!=this.width&&t!=this.width||null!=this.height&&i!=this.height;this.width=t,this.height=i,n&&this.changed()},changed:function(){o.add(e)}}},function(e){e.elementSizeCache=void 0},e.fn.badonkatrunc.settings.sizeTrackingTimeout),o=n(function(e){e.refresh.apply(e)},null,null,null),s=function(t,i,n,r,o){var s=t.text;if(r>1&&(r=1),0>r&&(r=0),1==r)return t.html;var a=function(e,i){var n=s.split(" "),r=o?n.length:s.length,a=r*e,l=r*i;if(o){var c=function(e){for(var t=0,i=0;e>i;i++)t+=n[i].length+1;return t},h=a+l;a=c(a),l=c(h)-a}return t.getHtmlSubstring(a,l)};switch(n){case"middle":var l=r/2,c=a(0,l),h=a(1-l,l);return e.trim(c)+" "+i+" "+e.trim(h);case"start":var u=a(1-r,r);return i+e.trim(u);case"end":var u=a(0,r);return e.trim(u)+i}},a=function(t){var i=e("<span></span>");i.html(t);var n={html:t,text:i.text(),getHtmlSubstring:function(t,n){var r=i.clone()[0],o=0,s=0,a=[],l=!1,c=function(e){if(3==e.nodeType){for(var i=e.data.length,r="",h=!1,u=0;i>u;u++)o++,o>=t&&n>s?(l=!0,h=!0,r+=e.data.substr(u,1),s++):1==l&&(l=!1);e.data=r,h&&a.push(e)}else if(1==e.nodeType){l&&a.push(e);for(var d=e.childNodes.length,u=0;d>u;u++)c(e.childNodes[u])}};c(r);for(var h=[],u=function(e){var t=function(e){h.push(e),null!=e.parentNode&&t(e.parentNode)};t(e)},d=a.length,p=0;d>p;p++)u(a[p]);var y=function(t){for(var i=[],n=t.childNodes.length,r=0;n>r;r++){var o=t.childNodes[r];3!=o.nodeType&&(-1==e.inArray(o,h)?i.push(o):y(o))}for(var r=0;r<i.length;r++){var t=i[r];t.parentNode.removeChild(t)}};return y(r),e(r).html()}};return n},l=function(e,t,i,n,r){for(var o=t,s=e,a=t,l=null,c=null,h=null,u=0;;){i(a);var d=n();if(0>=d){var p=!0;null!=c&&(c>d?p=!1:d==c&&h>=a&&(p=!1)),p&&(c=d,h=a)}if(d==l&&(u++,void 0==r||u==r))return null!=h&&i(h),void 0;if(d>0){o=a;var y=a-s;a-=y/2}else 0>=d&&(s=a,a=o);l=d}}}(jQuery);