!function(t){null==t.isNumeric&&(t.isNumeric=function(t){return null!=t&&t.constructor===Number}),null==t.isFunction&&(t.isFunction=function(t){return null!=t&&t instanceof Function});var e=t(window),i=t(document),n={defaultConfig:{animate:!1,cellW:100,cellH:100,delay:0,engine:"giot",fixSize:null,gutterX:15,gutterY:15,selector:"> div",draggable:!1,rightToLeft:!1,bottomToTop:!1,onStartSet:function(){},onGapFound:function(){},onComplete:function(){},onResize:function(){},onSetBlock:function(){}},plugin:{},totalGrid:1,transition:!1,loadBlock:function(e,i){var n=i.runtime,a=t(e),o=null,l=n.gutterX,r=n.gutterY,h=parseInt(a.attr("data-fixSize")),s=n.lastId++ +"-"+this.totalGrid;if(!a.hasClass("fw-float")){a.attr({id:s,"data-delay":e.index}),i.animate&&this.transition&&this.setTransition(e,""),null==a.attr("data-height")&&a.attr("data-height",a.height()),null==a.attr("data-width")&&a.attr("data-width",a.width());var u=1*a.attr("data-height"),d=1*a.attr("data-width"),c=a.attr("data-fixPos"),f=n.cellH,g=n.cellW,m=d?Math.round((d+l)/g):0,w=u?Math.round((u+r)/f):0;return isNaN(h)&&(h=null),h||"auto"!=i.cellH||(a.width(g*m-l),e.style.height="",u=a.height(),w=u?Math.round((u+r)/f):0),h||"auto"!=i.cellW||(a.height(f*w-r),e.style.width="",d=a.width(),m=d?Math.round((d+l)/g):0),null!=h&&(m>n.limitCol||w>n.limitRow)?o=null:(w&&w<n.minHoB&&(n.minHoB=w),m&&m<n.minWoB&&(n.minWoB=m),w>n.maxHoB&&(n.maxHoB=w),m>n.maxWoB&&(n.maxWoB=m),0==d&&(m=0),0==u&&(w=0),o={id:s,width:m,height:w,fixSize:h},c&&(c=c.split("-"),o.y=1*c[0],o.x=1*c[1],o.width=null!=h?m:Math.min(m,n.limitCol-o.x),o.height=null!=h?w:Math.min(w,n.limitRow-o.y),n.holes.push({top:o.y,left:o.x,width:o.width,height:o.height}),this.setBlock(o,i))),null==a.attr("data-state")?a.attr("data-state","init"):a.attr("data-state","move"),c?null:o}},setBlock:function(t,e){var i=e.runtime,n=i.gutterX,a=i.gutterY,o=t.height,l=t.width,r=i.cellH,h=i.cellW,s=t.x,u=t.y;e.rightToLeft&&(s=i.limitCol-s-l),e.bottomToTop&&(u=i.limitRow-u-o);var d={fixSize:t.fixSize,top:u*r,left:s*h,width:h*l-n,height:r*o-a};return d.top=1*d.top.toFixed(2),d.left=1*d.left.toFixed(2),d.width=1*d.width.toFixed(2),d.height=1*d.height.toFixed(2),t.id&&(i.blocks[t.id]=d),d},showBlock:function(e,i){function n(){if(s&&r.attr("data-state","start"),i.animate&&h.transition&&h.setTransition(e,u),l)l.fixSize&&(l.height=1*r.attr("data-height"),l.width=1*r.attr("data-width")),r.css({opacity:1,width:l.width,height:l.height}),r[o]({top:l.top,left:l.left}),null!=r.attr("data-nested")&&h.nestedGrid(e,i);else{var t=parseInt(e.style.height)||0,n=parseInt(e.style.width)||0,d=parseInt(e.style.left)||0,c=parseInt(e.style.top)||0;r[o]({left:d+n/2,top:c+t/2,width:0,height:0,opacity:0})}a.length-=1,i.onSetBlock.call(e,l,i),0==a.length&&i.onComplete.call(e,l,i)}var a=i.runtime,o=i.animate&&!this.transition?"animate":"css",l=a.blocks[e.id],r=t(e),h=this,s="move"!=r.attr("data-state"),u=s?"width 0.5s, height 0.5s":"top 0.5s, left 0.5s, width 0.5s, height 0.5s, opacity 0.5s";e.delay&&clearTimeout(e.delay),r.hasClass("fw-float")||(h.setTransition(e,""),e.style.position="absolute",i.onStartSet.call(e,l,i),i.delay>0?e.delay=setTimeout(n,i.delay*r.attr("data-delay")):n())},nestedGrid:function(e,i){var n,a=t(e),o=i.runtime,l=a.attr("data-gutterX")||i.gutterX,r=a.attr("data-gutterY")||i.gutterY,h=a.attr("data-method")||"fitZone",s=a.attr("data-nested")||"> div",u=a.attr("data-cellH")||i.cellH,d=a.attr("data-cellW")||i.cellW,c=o.blocks[e.id];if(c)switch(n=new freewall(a),n.reset({cellH:u,cellW:d,gutterX:1*l,gutterY:1*r,selector:s}),h){case"fitHeight":n[h](c.height);break;case"fitWidth":n[h](c.width);break;case"fitZone":n[h](c.width,c.height)}},adjustBlock:function(e,i){var n=i.runtime,a=n.gutterX,o=n.gutterY,l=t("#"+e.id),r=n.cellH,h=n.cellW;(i.cellH="auto")&&(l.width(e.width*h-a),l.get(0).style="",e.height=Math.round((l.height()+o)/r))},adjustUnit:function(e,i,n){var a=n.gutterX,o=n.gutterY,l=n.runtime,r=n.cellW,h=n.cellH;if(t.isFunction(r)&&(r=r(e)),r=1*r,!t.isNumeric(r)&&(r=1),t.isFunction(h)&&(h=h(i)),h=1*h,!t.isNumeric(h)&&(h=1),t.isNumeric(e)){1>r&&(r*=e);var s=Math.max(1,Math.floor(e/r));t.isNumeric(a)||(a=(e-s*r)/Math.max(1,s-1),a=Math.max(0,a)),s=Math.floor((e+a)/r),l.cellW=(e+a)/s,l.cellS=l.cellW/r,l.gutterX=a,l.limitCol=s}if(t.isNumeric(i)){1>h&&(h*=i);var u=Math.max(1,Math.floor(i/h));t.isNumeric(o)||(o=(i-u*h)/Math.max(1,u-1),o=Math.max(0,o)),u=Math.floor((i+o)/h),l.cellH=(i+o)/u,l.cellS=l.cellH/h,l.gutterY=o,l.limitRow=u}t.isNumeric(e)||(1>r&&(r=l.cellH),l.cellW=1!=r?r*l.cellS:1,l.gutterX=a,l.limitCol=666666),t.isNumeric(i)||(1>h&&(h=l.cellW),l.cellH=1!=h?h*l.cellS:1,l.gutterY=o,l.limitRow=666666)},resetGrid:function(t){t.blocks={},t.length=0,t.cellH=0,t.cellW=0,t.lastId=1,t.matrix={},t.totalCol=0,t.totalRow=0},setDragable:function(e,n){var a=!1,o={sX:0,sY:0,top:0,left:0,proxy:null,end:function(){},move:function(){},start:function(){}};t(e).each(function(){function e(t){return t.stopPropagation(),t=t.originalEvent,t.touches&&(a=!0,t=t.changedTouches[0]),2!=t.button&&3!=t.which&&(h.start.call(s,t),h.sX=t.clientX,h.sY=t.clientY,h.top=parseInt(u.css("top"))||0,h.left=parseInt(u.css("left"))||0,i.bind("mouseup touchend",r),i.bind("mousemove touchmove",l)),!1}function l(t){t=t.originalEvent,a&&(t=t.changedTouches[0]),u.css({top:h.top-(h.sY-t.clientY),left:h.left-(h.sX-t.clientX)}),h.move.call(s,t)}function r(t){t=t.originalEvent,a&&(t=t.changedTouches[0]),h.end.call(s,t),i.unbind("mouseup touchend",r),i.unbind("mousemove touchmove",l)}var h=t.extend({},o,n),s=h.proxy||this,u=t(s),d=u.css("position");"absolute"!=d&&u.css("position","relative"),t(this).find("iframe, form, input, textarea, .ignore-drag").each(function(){t(this).on("touchstart mousedown",function(t){t.stopPropagation()})}),i.unbind("mouseup touchend",r),i.unbind("mousemove touchmove",l),u.unbind("mousedown touchstart").bind("mousedown touchstart",e)})},setTransition:function(e,i){var n=e.style,a=t(e);!this.transition&&a.stop?a.stop():null!=n.webkitTransition?n.webkitTransition=i:null!=n.MozTransition?n.MozTransition=i:null!=n.msTransition?n.msTransition=i:null!=n.OTransition?n.OTransition=i:n.transition=i},getFreeArea:function(t,e,i){for(var n=Math.min(t+i.maxHoB,i.limitRow),a=Math.min(e+i.maxWoB,i.limitCol),o=a,l=n,r=i.matrix,h=t;l>h;++h)for(var s=e;a>s;++s)1==r[h+"-"+s]&&s>e&&o>s&&(o=s);for(var h=t;n>h;++h)for(var s=e;o>s;++s)1==r[h+"-"+s]&&h>t&&l>h&&(l=h);return{top:t,left:e,width:o-e,height:l-t}},setWallSize:function(t,e){var i=Math.max(1,t.totalRow),n=Math.max(1,t.totalCol),a=t.gutterY,o=t.gutterX,l=t.cellH,r=t.cellW,h=r*n-o,s=l*i-a;e.attr({"data-total-col":n,"data-total-row":i,"data-wall-width":Math.ceil(h),"data-wall-height":Math.ceil(s)}),t.limitCol<t.limitRow&&!e.attr("data-height")&&e.height(Math.ceil(s))}},a={giot:function(t,e){function i(t,e,i,n){for(var a=t;t+n>a;){for(var o=e;e+i>o;)g[a+"-"+o]=!0,++o>s&&(s=o);++a>u&&(u=a)}}var a=e.runtime,o=a.limitRow,l=a.limitCol,r=0,h=0,s=a.totalCol,u=a.totalRow,d={},c=a.holes,f=null,g=a.matrix,m=Math.max(l,o),w=null,v=null,p=o>l?1:0,x=null,M=Math.min(l,o);if(c.length)for(var B=0;B<c.length;++B)i(c[B].top,c[B].left,c[B].width,c[B].height);for(var k=0;m>k&&t.length;++k){p?h=k:r=k,x=null;for(var y=0;M>y&&t.length;++y)if(p?r=y:h=y,!a.matrix[h+"-"+r]){w=n.getFreeArea(h,r,a),f=null;for(var B=0;B<t.length;++B)if(!(t[B].height>w.height||t[B].width>w.width)){f=t.splice(B,1)[0];break}if(null==f&&null==e.fixSize){if(x&&!p&&a.minHoB>w.height){x.height+=w.height,i(x.y,x.x,x.width,x.height),n.setBlock(x,e);continue}if(x&&p&&a.minWoB>w.width){x.width+=w.width,i(x.y,x.x,x.width,x.height),n.setBlock(x,e);continue}for(var B=0;B<t.length;++B)if(null==t[B].fixSize){f=t.splice(B,1)[0],p?(f.width=w.width,"auto"==e.cellH&&n.adjustBlock(f,e),f.height=Math.min(f.height,w.height)):(f.height=w.height,f.width=Math.min(f.width,w.width));break}}if(null!=f)d[f.id]={id:f.id,x:r,y:h,width:f.width,height:f.height,fixSize:f.fixSize},x=d[f.id],i(x.y,x.x,x.width,x.height),n.setBlock(x,e);else{var v={x:r,y:h,fixSize:0};if(p){v.width=w.width,v.height=0;for(var b=r-1,S=h;g[S+"-"+b];)g[S+"-"+r]=!0,v.height+=1,S+=1}else{v.height=w.height,v.width=0;for(var S=h-1,b=r;g[S+"-"+b];)g[h+"-"+b]=!0,v.width+=1,b+=1}e.onGapFound(n.setBlock(v,e),e)}}}a.matrix=g,a.totalRow=u,a.totalCol=s}};window.freewall=function(i){function o(e){var i=(u.gutterX,u.gutterY,u.cellH),a=u.cellW;n.setDragable(e,{start:function(){s.animate&&n.transition&&n.setTransition(this,""),t(this).css("z-index",9999).addClass("fw-float")},move:function(){var e=t(this).position(),n=Math.round(e.top/i),o=Math.round(e.left/a),l=Math.round(t(this).width()/a),r=Math.round(t(this).height()/i);n=Math.min(Math.max(0,n),u.limitRow-r),o=Math.min(Math.max(0,o),u.limitCol-l),h.setHoles([{top:n,left:o,width:l,height:r}]),h.refresh()},end:function(){var e=t(this).position(),n=Math.round(e.top/i),o=Math.round(e.left/a),l=Math.round(t(this).width()/a),r=Math.round(t(this).height()/i);n=Math.min(Math.max(0,n),u.limitRow-r),o=Math.min(Math.max(0,o),u.limitCol-l),t(this).css({zIndex:"auto",top:n*i,left:o*a}).removeClass("fw-float"),h.fillHoles()}})}var l=t(i);"static"==l.css("position")&&l.css("position","relative");var r=Number.MAX_VALUE,h=this;n.totalGrid+=1;var s=t.extend({},n.defaultConfig),u={blocks:{},events:{},matrix:{},holes:[],cellW:0,cellH:0,cellS:1,filter:"",lastId:0,length:0,maxWoB:0,maxHoB:0,minWoB:r,minHoB:r,running:0,gutterX:15,gutterY:15,totalCol:0,totalRow:0,limitCol:666666,limitRow:666666,currentMethod:null,currentArguments:[]};s.runtime=u;var d=document.body.style;n.transition||(null!=d.webkitTransition||null!=d.MozTransition||null!=d.msTransition||null!=d.OTransition||null!=d.transition)&&(n.transition=!0),t.extend(h,{addCustomEvent:function(t,e){var i=u.events;return t=t.toLowerCase(),!i[t]&&(i[t]=[]),e.eid=i[t].length,i[t].push(e),this},appendBlock:function(e){var i=t(e).appendTo(l),r=null,d=[];i.each(function(t,e){e.index=++t,(r=n.loadBlock(e,s))&&(d.push(r),h.fireEvent("onBlockLoad",e,s))}),a[s.engine](d,s),n.setWallSize(u,l),u.length=i.length,i.each(function(t,e){s.draggable&&o(e),n.showBlock(e,s),h.fireEvent("onBlockShow",e,s)})},appendHoles:function(t){return u.holes=u.holes.concat(t),this},container:l,fillHoles:function(){return u.holes=[],this},filter:function(t){return u.filter=t,u.currentMethod&&this.refresh(),this},fireEvent:function(t,e,i){var n=u.events;if(t=t.toLowerCase(),n[t]&&n[t].length)for(var a=0;a<n[t].length;++a)n[t][a].call(e,i);return this},fitHeight:function(i){var r=l.find(s.selector).removeAttr("id"),d=null,c=[];i=i?i:l.height()||e.height(),u.currentMethod=arguments.callee,u.currentArguments=arguments,n.resetGrid(u),n.adjustUnit("auto",i,s),u.filter?(r.data("active",0),r.filter(u.filter).data("active",1)):r.data("active",1),h.fireEvent("onGridReady",l,s),r.each(function(e,i){var a=t(i);i.index=++e,(d=n.loadBlock(i,s))&&(a.data("active")&&c.push(d),h.fireEvent("onBlockLoad",i,s))}),h.fireEvent("onGridLoad",l,s),a[s.engine](c,s),n.setWallSize(u,l),h.fireEvent("onGridArrange",l,s),u.length=r.length,r.each(function(t,e){s.draggable&&o(e),n.showBlock(e,s),h.fireEvent("onBlockShow",e,s)}),h.fireEvent("onGridShow",l,s)},fitWidth:function(i){var r=l.find(s.selector).removeAttr("id"),d=null,c=[];i=i?i:l.width()||e.width(),u.currentMethod=arguments.callee,u.currentArguments=arguments,n.resetGrid(u),n.adjustUnit(i,"auto",s),u.filter?(r.data("active",0),r.filter(u.filter).data("active",1)):r.data("active",1),h.fireEvent("onGridReady",l,s),r.each(function(e,i){var a=t(i);i.index=++e,(d=n.loadBlock(i,s))&&(a.data("active")&&c.push(d),h.fireEvent("onBlockLoad",i,s))}),h.fireEvent("onGridLoad",l,s),a[s.engine](c,s),n.setWallSize(u,l),h.fireEvent("onGridArrange",l,s),u.length=r.length,r.each(function(t,e){s.draggable&&o(e),n.showBlock(e,s),h.fireEvent("onBlockShow",e,s)}),h.fireEvent("onGridShow",l,s)},fitZone:function(i,r){var d=l.find(s.selector).removeAttr("id"),c=null,f=[];r=r?r:l.height()||e.height(),i=i?i:l.width()||e.width(),u.currentMethod=arguments.callee,u.currentArguments=arguments,n.resetGrid(u),n.adjustUnit(i,r,s),u.filter?(d.data("active",0),d.filter(u.filter).data("active",1)):d.data("active",1),h.fireEvent("onGridReady",l,s),d.each(function(e,i){var a=t(i);i.index=++e,(c=n.loadBlock(i,s))&&(a.data("active")&&f.push(c),h.fireEvent("onBlockLoad",i,s))}),h.fireEvent("onGridLoad",l,s),a[s.engine](f,s),n.setWallSize(u,l),h.fireEvent("onGridArrange",l,s),u.length=d.length,d.each(function(t,e){s.draggable&&o(e),n.showBlock(e,s),h.fireEvent("onBlockShow",e,s)}),h.fireEvent("onGridShow",l,s)},fixPos:function(e){return t(e.block).attr({"data-fixPos":e.top+"-"+e.left}),this},fixSize:function(e){return null!=e.width&&t(e.block).attr({"data-width":e.width}),null!=e.height&&t(e.block).attr({"data-height":e.height}),this},prepend:function(t){return l.prepend(t),u.currentMethod&&this.refresh(),this},refresh:function(){var t=arguments.length?arguments:u.currentArguments;return null==u.currentMethod&&(u.currentMethod=this.fitWidth),u.currentMethod.apply(this,Array.prototype.slice.call(t,0)),this},reset:function(e){return t.extend(s,e),this},setHoles:function(t){return u.holes=[].concat(t),this},unFilter:function(){return delete u.filter,this.refresh(),this}}),l.attr("data-min-width",80*Math.floor(e.width()/80));for(var c in n.plugin)n.plugin.hasOwnProperty(c)&&n.plugin[c].call(h,s,l);e.resize(function(){u.running||(u.running=1,setTimeout(function(){u.running=0,s.onResize.call(h,l)},122),l.attr("data-min-width",80*Math.floor(e.width()/80)))})},freewall.createPlugin=function(e){return t.extend(n.plugin,e),{addConfig:function(e){t.extend(n.defaultConfig,e)}}},freewall.createEngine=function(e){t.extend(a,e)},freewall.getMethod=function(t){return n[t]}}(window.Zepto||window.jQuery);